# 1) ë“œë¼ì´ë¸Œ ë§ˆìš´íŠ¸
from google.colab import drive
drive.mount('/content/drive')

import os, shutil, glob

DRIVE_BASE = "/content/drive/MyDrive/dataset"
TARGET_ROOT = "/content/mt/ai/emotion"
os.makedirs(f"{TARGET_ROOT}/val", exist_ok=True)
os.makedirs(f"{TARGET_ROOT}/checkpoints_finetune", exist_ok=True)

# 2) ì†ŒìŠ¤ ê²½ë¡œ í›„ë³´ (ìœ ì—° íƒìƒ‰)
val_candidates = [
    f"{DRIVE_BASE}/ai/emotion/val",
    f"{DRIVE_BASE}/emotion/val",
    f"{DRIVE_BASE}/val",
]
# ê¸°ì¡´ íŒŒì¸íŠœë‹ ëª¨ë¸ê³¼ ì¬í•™ìŠµ ëª¨ë¸ ëª¨ë‘ ì°¾ê¸°
original_ckpt_candidates = [
    f"{DRIVE_BASE}/ai/emotion/checkpoints_finetune/best_model_original.pth",
    f"{DRIVE_BASE}/emotion/checkpoints_finetune/best_model_original.pth", 
    f"{DRIVE_BASE}/checkpoints_finetune/best_model_original.pth",
]
retrained_ckpt_candidates = [
    f"{DRIVE_BASE}/ai/emotion/checkpoints_finetune/best_model.pth",
    f"{DRIVE_BASE}/emotion/checkpoints_finetune/best_model.pth",
    f"{DRIVE_BASE}/checkpoints_finetune/best_model.pth",
]
script_candidates = [
    f"{DRIVE_BASE}/ai/emotion/compare_eval_colab.py",
    f"{DRIVE_BASE}/compare_eval_colab.py",
]

def first_existing(paths):
    for p in paths:
        if os.path.exists(p):
            return p
    return None

src_val = first_existing(val_candidates)
src_original_ckpt = first_existing(original_ckpt_candidates)
src_retrained_ckpt = first_existing(retrained_ckpt_candidates)
src_script = first_existing(script_candidates)

assert src_val and os.path.isdir(src_val), f"val í´ë”ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë“œë¼ì´ë¸Œ ê²½ë¡œ í™•ì¸: {val_candidates}"
assert src_original_ckpt and os.path.isfile(src_original_ckpt), f"ì›ë³¸ íŒŒì¸íŠœë‹ ëª¨ë¸ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë“œë¼ì´ë¸Œ ê²½ë¡œ í™•ì¸: {original_ckpt_candidates}"
assert src_retrained_ckpt and os.path.isfile(src_retrained_ckpt), f"ì¬í•™ìŠµ ëª¨ë¸ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë“œë¼ì´ë¸Œ ê²½ë¡œ í™•ì¸: {retrained_ckpt_candidates}"
assert src_script and os.path.isfile(src_script), f"compare_eval_colab.pyë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë“œë¼ì´ë¸Œ ê²½ë¡œ í™•ì¸: {script_candidates}"

# 3) val ë°ì´í„° ë³µì‚¬ (í´ë˜ìŠ¤ í´ë” ìœ ì§€)
classes = ['angry','happy','relaxed','sad']
for cls in classes:
    os.makedirs(f"{TARGET_ROOT}/val/{cls}", exist_ok=True)
    src_cls = os.path.join(src_val, cls)
    assert os.path.isdir(src_cls), f"í´ë˜ìŠ¤ í´ë” ì—†ìŒ: {src_cls}"
    for fp in glob.glob(os.path.join(src_cls, "*")):
        if os.path.isfile(fp):
            shutil.copy2(fp, f"{TARGET_ROOT}/val/{cls}/")

# 4) ì²´í¬í¬ì¸íŠ¸/ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬ (ì›ë³¸ê³¼ ì¬í•™ìŠµ ëª¨ë¸ ëª¨ë‘)
shutil.copy2(src_original_ckpt, f"{TARGET_ROOT}/checkpoints_finetune/best_model_original.pth")
shutil.copy2(src_retrained_ckpt, f"{TARGET_ROOT}/checkpoints_finetune/best_model.pth")
shutil.copy2(src_script, f"/content/mt/ai/emotion/compare_eval_colab.py")

# 5) íŒŒì¼ í™•ì¸
import os
print("ğŸ“ ë³µì‚¬ëœ íŒŒì¼ í™•ì¸:")
print(f"- val í´ë”: {os.path.isdir(f'{TARGET_ROOT}/val')} ({len(os.listdir(f'{TARGET_ROOT}/val'))}ê°œ í´ë˜ìŠ¤)")
print(f"- ì›ë³¸ íŒŒì¸íŠœë‹ ëª¨ë¸: {os.path.isfile(f'{TARGET_ROOT}/checkpoints_finetune/best_model_original.pth')}")
print(f"- ì¬í•™ìŠµ ëª¨ë¸: {os.path.isfile(f'{TARGET_ROOT}/checkpoints_finetune/best_model.pth')}")
print(f"- ìŠ¤í¬ë¦½íŠ¸: {os.path.isfile('/content/mt/ai/emotion/compare_eval_colab.py')}")

# 6) ì‹¤í–‰
print("\nğŸš€ ì„±ëŠ¥ ë¹„êµ ë¶„ì„ ì‹œì‘!")
%run /content/mt/ai/emotion/compare_eval_colab.py